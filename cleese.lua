pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--game loop and game obj

game={
	init=function(self)
		game.update=title_update
		game.draw=title_draw
	end,
	update=function(self) end,
	draw=function(self) end	
}

function _init()
	game:init()
end

function _update()
	game:update()
end

function _draw()
	if game.draw==nil then
		print("nil value")
	else
		game:draw()
	end	
end				
-->8
--title screen

title_t = 0
title_c = 7

function title_init()
	game.update=title_update
	game.draw=title_draw
	print("title initialized")
end

--game_init=title_init

function title_update()
	if btnp(❎) then
		cr_init()
	end	
end

function title_draw()
	cls()
	map(1,0,32,32)
	print("welcome to the jungle",
	24,100,7)
	if title_t<10 then
		title_c=7
	elseif title_t<20 then
		title_c=5
	elseif title_t<30 then
		title_c=0
	elseif title_t<40 then
		title_c=5
	elseif title_t<50 then
		title_t=0
	end
	print("press ❎ to start",
	32,110,title_c)
	title_t+=1
end
-->8
--game scene

function play_init()
	x=32
	y=32
	game.update=play_update
	game.draw=play_draw
	make_player()
end

function play_update()
	p:input()
	p:update()
end

function play_draw()
	cls()
	p:draw()
end
-->8
--utils

function swap_tile(x,y)
	tile=mget(x,y)
	mset(x,y,tile+1)
end

function unswap_tile(x,y)
	tile=mget(x,y)
	mset(x,y,tile-1)
end

--animation
function animate(x)
	print("animating")
	if x.state~=x.play then
		x.state=x.play
		x.a_idx=1
		x.t=0
		print(x.state)
	elseif #x.anims[x.state] > 1
	then
		x.t += 1
		if x.t % 
		(x.anims[x.state].fr) == 0 
		then
			x.a_idx = (x.a_idx 
			% #x.anims[x.state]) + 1
			if x.a_idx == 1 and
			x.anims[x.state].next then
				x.play = x.anims[x.state].next
				x.state = x.play
			end	
		end
	end
	x.spr = 
	x.anims[x.state][x.a_idx]
end

--collision detection
function det_colls(subject,objects)
	for obj in all(objects) do
		if subject.x+subject.w*tile_size > obj.x 
		and subject.x+subject.w*tile_size < obj.x+obj.w*tile_size
	 and	subject.y+subject.h*tile_size > obj.y 
	 and subject.y+subject.h*tile_size < obj.y+obj.h*tile_size then
			subject.col=obj
			if subject.dx > 0 then
				return "right"
			elseif subject.dx < 0 then
			 return "left"
			elseif subject.dy > 0 then
			 return "down"
			elseif subject.dy < 0 then
				return "up" 
			end
		else	
			subject.col=nil	
		end
	end
end

--object management
objs = {}                    --a list of all the objects in the game (starts empty)
function objdraw(o)          --a basic function for drawing objects,
 spr(o.spr,o.x,o.y)            --as long as those objects have spr, x, and y values inside
end
function bulletupdate(b)     --a function for moving bullets a little bit at a time
 b.x += b.dx                 --x moves by the change in x every frame (dx)
 b.y += b.dy                 --y moves by the change in y every frame (dy)
 b.time -= 1                 --if bullets have existed for too long, erase them
 return b.time > 0           --returns true if still alive, false if it needs to be removed
end
function newbullet(x,y,w,h,dx,dy)--bullets have position x,y, width, height, and move dx,dy each frame
 local b = {                 --only use the b table inside this function, it's "local" to it
  x=x,y=y,dx=dx,dy=dy,       --the x=x means let b.x = the value stored in newbullet()'s x variable
  w=w,h=h,                   --b.w and b.h are also set to the function's w and h args
  time=60,                   --this is how long a bullet will last before disappearing
  update=bulletupdate,       --you can put functions in tables just like any other value
  spr=0,draw=objdraw         --bullets don't have special drawing code, so re-use a basic object draw
 }
 add(objs,b)                 --now we can manage all bullets in a list
 return b                    --and if some are special, we can adjust them a bit outside of this function
end

function obj_draw()             --the game's draw function, only called 30 times/second when there's no lag
 cls()
 for o in all(objs) do o:draw() end --o:draw() is the same as o.draw(o). this is useful here!
end

function obj_update()           --the game's update function, always called 30 times/second
 local i,j=1,1               --to properly support objects being deleted, can't use del() or deli()
 while(objs[i]) do           --if we used a for loop, adding new objects in object updates would break
  if objs[i]:update() then
   if(i!=j) objs[j]=objs[i] objs[i]=nil --shift objects if necessary
   j+=1
  else objs[i]=nil end       --remove objects that have died or timed out
  i+=1                       --go to the next object (including just added objects)
 end
end


-->8
--player

function make_player()
	p = {
		x = 32,
		y = 32,
		dx = 0,
		dy = 0,
		ax = 0,
		ay = 0,
		dir = nil,
		play = "idle",
		a_idx = 0,
		t = 1,
		flip = false,
		spr = 128,
		anims = {
			idle = {fr=15, 128, 130},
			walkx = {fr=10, 132, 134}
		},
		input = function(self)
			if btn(⬅️) then
				self.x -= 1
			end
			if btn(➡️) then
				self.x += 1
			end
			if btnp(❎) then
				title_init()
			end
		end,
		update = function(self)
			self.x += self.dx
			self.y += self.dy
			animate(self)
		end,
		draw = function(self)
			print(self.spr)
			spr(self.spr, self.x,
			self.y, 2, 2, self.flip)
		end
	}	 
end
-->8
--dialogue

open_credits = {
 "arthur cleese is in \n a swanky",
 "apartment. it's his going away",
 "party.",
 "▒"
}

credits_t = 1

function cr_init()
	game.update = cr_update
	game.draw = cr_draw
end

function cr_update()
	if btnp(❎) then
		credits_t += 1
	end
	if open_credits[credits_t] ==
	"▒" then
		play_init()
	end
end

function cr_draw()
	cls()
	rect(10,32,100,100,3)
	print(open_credits[credits_t],
	12,34,2)
end
__gfx__
00000000000000000000000000000000000000000000000000000009999000000000000000000000000000000000000000000000000000000000000000000000
00000000000000099900000000000000000000000000000000000099cc9990000000000000000000000000000000000000000000000000000000000000000000
0070070000009990900000000000000099900000000099900000099ccccc90000000990099900000000000000000000000000000000000000000000000000000
0007700000099cc990000000000099999c90000099999c9000099ccccc9990000999990090900000000000000000000000000000000000000000000000000000
00077000099ccc999009990000099ccccc9000099ccccc900099cccc9990000099ccc90000900000000000000000000000000000000000000000000000000000
0070070099ccc99000090900009ccccc9999009ccccc99990099ccccc9000009cccc990099900000000000000000000000000000000000000000000000000000
000000009cccc90000099990009ccc999009009ccc999009000999cccc900009ccc9900090000000000000000000000000000000000000000000000000000000
000000009ccc900000009c90009ccc999000009ccc999000000009999c990009ccc9900090000000000000000000000000000000000000000000000000000000
000000009cc9900000009c90009ccc999990009ccc999990009999009cc99009cc99999099900000000000000000000000000000000000000000000000000000
000000009cc9900000099c900009cccccc900009cccccc90009cc9999ccc90099ccccc9000900000000000000000000000000000000000000000000000000000
000000009ccc99000009cc900009ccc999900009ccc999900099cccccccc90009cc9999099900000000000000000000000000000000000000000000000000000
0000000099cccc990009cc900009ccc999990009ccc999999009ccccc9cc900099c9999999900000000000000000000000000000000000000000000000000000
00000000099cccc99009cc900009ccccccc90009ccccccc990099cccc9c9900099ccccc900000000000000000000000000000000000000000000000000000000
0000000000999ccc9009cc9000009cc9999900009cc9999900009cc999c900009cc9999999900000000000000000000000000000000000000000000000000000
00000000000099999009cc9999009990000000009990000000009999099900009990000000000000000000000000000000000000000000000000000000000000
00000000000000990009ccccc9009900000000009900000000000000099000009900000000000000000000000000000000000000000000000000000000000000
00000000000000000009c99999000000000000000000000000000000099000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000009990099900000000000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000009c900009099000009999000999999990000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000009c9900099c9999009cc900009cccccc9900000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000009ccc900009cccc99999c900009ccccccc990000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000099cccc9900009ccccc999cc900099cc999cc99000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000099cc9cc900009cccccccccc900009cc909ccc9000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000999ccccc9000099ccccccccc900009ccc9cc9c9000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000009cccccc9000009ccccccccc990009cccccc999000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000099ccc9cc9000009ccc99cccc9000099cccccc90000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000099ccc99cc9000009cc9999ccc9000009cccc9990000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000009ccc999cc9900009cc90099c99000009c9999000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000009ccc909ccc900009cc9000099000000999000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000009cc90099cc990009cc9900009000000900099999990000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000999900099999000999990000000000099999ccccc90000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000900000000000000990000000000000099cccccccc90000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000009000000099000009cccc99999900000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000999999999999990099000999900009ccc990000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000099cccccccccccc900099009cc990009cc9990000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000009999cccccc99990099999ccc90009cc9c99900000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000990999ccc99000009ccccccc90009cc9c99000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000009cc990000009cccccccc9009ccc990000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000009cc900000009ccc999cc9009cc9999000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000009cc900000009cc9909cc9009ccccc9990000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000009cc990000009c99009cc9009ccccccc99000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000009ccc90000009c90009c99009999cccc90000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000009c9990000009c90009c90009900999990000000000999000000000000000000000000000000000000000000000000000000000
000000000000000000000000009990000000099900099900000000000000000000999c9000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000900000000000000000000000000009cc9000000000000000000000000000000000000000000000000000000000
000000000000000000009900000000000000000000000000000000000000000900099c9000000000000000000000000000000000000000000000000000000000
000000000000000000099c99990000000000000000000000000000009999000999909c9000000000000000000000000000000000000000000000000000000000
00000000999990000009cccccc9900000090000000000900000000099cc990999cc9999000000000000000000000000000000000000000000000000000000000
000000009cccc99900009ccc9cc99000009900000000099000000009cccc99009cccc99000000000000000000000000000000000000000000000000000000000
000000009cccccc990009cc999cc9900009900000000999990000099ccccc9009ccccc9000000000000000000000000000000000000000000000000000000000
0000000099cccccc90009cc999cc990009cc900000009cc990000099cc9cc90099cccc9000000000000000000000000000000000000000000000000000000000
0000000009cccccc99009cc99cc9900009cc900000009c9900000009c99cc90009cccc9000000000000000000000000000000000000000000000000000000000
0000000009ccccccc9009ccccc99900009c9c9000009cc9000000009c99cc90009c9cc9000000000000000000000000000000000000000000000000000000000
0000000009cc99ccc9009cccc99c99009cccc9900009cc9000000009cc9cc90009c99c9900000000000000000000000000000000000000000000000000000000
0000000009cc999cc9009ccc9cccc9009ccccc900009cc9999990009ccccc99009cc990900000000000000000000000000000000000000000000000000000000
0000000009cc909cc90009cc99ccc9009cc9cc900099c999ccc99009ccccc90009cc990900000000000000000000000000000000000000000000000000000000
0000000009cc909cc90009cc909cc9009cc99c99009cc99ccccc90099ccc990009cc909900000000000000000000000000000000000000000000000000000000
0000000009c9999cc90009cc9099c9099cc99909009cccccc9cc90009c99900009c9909900000000000000000000000000000000000000000000000000000000
0000000009ccccccc90009cc9009c909ccc909099099ccccc99c90009c90000009c9900000000000000000000000000000000000000000000000000000000000
0000000009cccccc990009cc90099900999900999009cccc999990009990000009c9900000000000000000000000000000000000000000000000000000000000
0000000009cccc99900009cc900000000000000000099ccc90000000990000000999000000000000000000000000000000000000000000000000000000000000
0000000009999990000009999900000000000000000099c990000000000000000900000000000000000000000000000000000000000000000000000000000000
00000000099000000000000099000000000000000000099900000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000ffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000f0000f00000000000ffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000f000000f000000000f0000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000f000000f00000000f000000f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000f000000f00000000f000000f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000f0000f000000000f000000f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000bbbb00000000000f0000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00f0bb0000bb0f00000000bbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0f0fb000000bf0f000f0bb0000bb0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0f0fbb0000bbfff00f0fb000000bf0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00f0b0bbbb0b0f000f0fbb0000bbfff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000b4004b0000000f0b0bbbb0b0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000040bbbb04000000000b4004b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000400440040000000040bbbb040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000440044000000000444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0001020304050607080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0011121314151617180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0021222324252627280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0031323334353637380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0041424344454647480000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0051525354555657580000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0061626364656667680000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0071727374757677780000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
